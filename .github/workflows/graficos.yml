name: Generador de Graficos

on:
  workflow_run:
    workflows: ["Monitor Volcanico VRP"]
    types: [completed]

concurrency:
  group: generador-graficos
  cancel-in-progress: true

jobs:
  pintar_y_publicar:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout del repositorio
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Instalar librerÃ­as
        run: pip install pandas plotly pytz

      - name: Ejecutar el Visualizador
        run: python visualizador.py

      - name: Guardar en GitHub
        run: |
          git config --global user.name "VolcanoVisualizer"
          git config --global user.email "viz@volcano.com"
          
          # AGREGAMOS LA CARPETA DE LAS TARJETAS
          git add monitoreo_satelital/v_html/
          git add monitoreo_satelital/estado_sistema.json
          
          if ! git diff --quiet --staged; then
            git commit -m "ðŸ“Š Tarjetas interactivas generadas"
            git pull origin main --rebase -X ours
            git push origin main
          fi
