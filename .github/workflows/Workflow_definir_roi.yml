name: Definir ROI para OCR

on:
  workflow_dispatch:  # Ejecutar manualmente
    inputs:
      volcan:
        description: 'Volc치n para test (Lastarria, Lascar, Copahue, etc)'
        required: true
        default: 'Lastarria'
      sensor:
        description: 'Sensor (VIIRS375, VIIRS, MODIS)'
        required: true
        default: 'VIIRS375'

jobs:
  definir_roi:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install opencv-python-headless numpy pillow requests
      
      - name: Ejecutar an치lisis ROI
        run: |
          # Configurar volc치n y sensor desde inputs
          export VOLCAN_TEST="${{ github.event.inputs.volcan }}"
          export SENSOR_TEST="${{ github.event.inputs.sensor }}"
          
          # Modificar script para usar variables
          sed -i "s/VOLCAN_TEST = \"Lastarria\"/VOLCAN_TEST = \"$VOLCAN_TEST\"/" definir_roi_github.py
          sed -i "s/SENSOR_TEST = \"VIIRS375\"/SENSOR_TEST = \"$SENSOR_TEST\"/" definir_roi_github.py
          
          # Ejecutar
          python definir_roi_github.py
      
      - name: Upload ROI data
        uses: actions/upload-artifact@v3
        with:
          name: roi-analisis
          path: |
            roi_coordenadas.json
            roi_codigo.py
            ROI_MARCADA_COMPLETA.png
            ROI_AMPLIADA_CON_PUNTOS.png
          retention-days: 30
      
      - name: Mostrar resumen
        run: |
          echo "## 游늵 ROI Definida" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Volc치n:** ${{ github.event.inputs.volcan }}" >> $GITHUB_STEP_SUMMARY
          echo "**Sensor:** ${{ github.event.inputs.sensor }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Coordenadas:" >> $GITHUB_STEP_SUMMARY
          echo '```json' >> $GITHUB_STEP_SUMMARY
          cat roi_coordenadas.json >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### C칩digo Python:" >> $GITHUB_STEP_SUMMARY
          echo '```python' >> $GITHUB_STEP_SUMMARY
          cat roi_codigo.py >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "游닌 Descarga artefactos para ver im치genes" >> $GITHUB_STEP_SUMMARY
