<script>
    function checkAudit() {
        // Añadimos un catch más detallado para debug
        fetch('monitoreo_satelital/estado_sistema.json?t=' + new Date().getTime())
        .then(res => {
            if(!res.ok) throw new Error("Archivo no encontrado");
            return res.json();
        })
        .then(data => {
            const badge = document.getElementById('sys-status');
            badge.innerText = data.estado;
            badge.style.color = data.color;
            badge.style.borderColor = data.color;
            document.getElementById('last-sync').innerText = data.ultima_actualizacion;
            
            // Recarga el iframe solo si el fetch fue exitoso
            const frame = document.getElementById('plotly-frame');
            const currentSrc = 'monitoreo_satelital/dashboard_interactivo.html?t=' + new Date().getTime();
            if(frame.src !== currentSrc) frame.src = currentSrc;
        })
        .catch((err) => { 
            console.error("Error de auditoría:", err);
            document.getElementById('sys-status').innerText = "⚪ SINCRONIZANDO..."; 
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        checkAudit();
        setInterval(checkAudit, 300000); // Revisar cada 5 min
    });
</script>
